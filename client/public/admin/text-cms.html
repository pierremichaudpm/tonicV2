<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMS Mobile-Friendly | Groupe Tonic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal { display: none; }
        .modal.active { display: flex; }
        .content-preview { max-height: 150px; overflow: hidden; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- Login Modal -->
    <div id="loginModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-sm w-full m-4">
            <h2 class="text-xl font-bold mb-4">Connexion CMS</h2>
            <form id="loginForm">
                <input type="password" id="passwordInput" placeholder="Mot de passe" 
                       class="w-full px-3 py-2 border rounded-lg mb-4" required>
                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                    Se connecter
                </button>
            </form>
        </div>
    </div>

    <!-- Main CMS Interface -->
    <div id="cmsInterface" class="hidden">
        
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-6xl mx-auto px-4 py-3">
                <div class="flex items-center justify-between">
                    <h1 class="text-xl font-bold text-gray-900">Gestion de Contenu</h1>
                    <div class="flex items-center gap-3">
                        <select id="languageSelect" class="px-3 py-1 border rounded text-sm">
                            <option value="fr">Français</option>
                            <option value="en">English</option>
                        </select>
                        <button onclick="logout()" class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                            Déconnexion
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="bg-white border-b">
            <div class="max-w-6xl mx-auto px-4">
                <div class="flex space-x-8">
                    <button onclick="switchTab('news')" id="newsTab" class="py-3 border-b-2 border-blue-500 text-blue-600 font-medium">
                        Actualités
                    </button>
                    <button onclick="switchTab('jobs')" id="jobsTab" class="py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                        Emplois
                    </button>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="max-w-6xl mx-auto px-4 py-6">
            
            <!-- Add Content Button -->
            <div class="mb-6">
                <button onclick="showAddModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                    + Ajouter du contenu
                </button>
            </div>

            <!-- Content List -->
            <div id="contentList" class="space-y-4">
                <!-- Content items will be loaded here -->
            </div>

        </div>

    </div>

    <!-- Add/Edit Content Modal -->
    <div id="contentModal" class="modal fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg w-full max-w-2xl max-h-screen overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="modalTitle" class="text-xl font-bold">Nouveau Contenu</h2>
                    <button onclick="closeContentModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                
                <form id="contentForm">
                    <input type="hidden" id="contentId">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Titre</label>
                            <input type="text" id="contentTitle" class="w-full px-3 py-2 border rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Catégorie</label>
                            <select id="contentCategory" class="w-full px-3 py-2 border rounded-lg" required>
                                <option value="">Sélectionner...</option>
                                <option value="Beach Pro Tour">Beach Pro Tour</option>
                                <option value="Grands Prix Cyclistes">Grands Prix Cyclistes</option>
                                <option value="Marathon Beneva 21K">Marathon Beneva 21K</option>
                                <option value="UCI 2026">UCI 2026</option>
                                <option value="Studio 76">Studio 76</option>
                                <option value="Dock 619">Dock 619</option>
                                <option value="21K de Montréal">21K de Montréal</option>
                                <option value="Groupe Tonic">Groupe Tonic</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1">Sous-titre/Description</label>
                        <input type="text" id="contentSubtitle" class="w-full px-3 py-2 border rounded-lg" required>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Date</label>
                            <input type="date" id="contentDate" class="w-full px-3 py-2 border rounded-lg" required>
                        </div>
                        <div id="jobFields" class="hidden">
                            <label class="block text-sm font-medium mb-1">Salaire</label>
                            <input type="text" id="contentSalary" class="w-full px-3 py-2 border rounded-lg" placeholder="À discuter">
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-1">Contenu complet (HTML accepté)</label>
                        <textarea id="contentBody" rows="10" class="w-full px-3 py-2 border rounded-lg font-mono text-sm" required
                                  placeholder="Copiez-collez directement depuis Word. Ajoutez une ligne vide entre chaque paragraphe."></textarea>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-2 justify-end">
                        <button type="button" onclick="closeContentModal()" class="px-4 py-2 text-gray-600 border rounded-lg hover:bg-gray-50">
                            Annuler
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Enregistrer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="../js/content-data.js"></script>
    <script>
        let currentTab = 'news';
        let isAuthenticated = false;

        // Check authentication on load
        window.addEventListener('load', function() {
            const authStatus = sessionStorage.getItem('cmsAuth');
            if (authStatus === 'authenticated') {
                showCMS();
            } else {
                showLogin();
            }
        });

        function showLogin() {
            document.getElementById('loginModal').classList.add('active');
            document.getElementById('cmsInterface').classList.add('hidden');
        }

        function showCMS() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('cmsInterface').classList.remove('hidden');
            isAuthenticated = true;
            initializeSampleContent();
            loadContent();
        }

        // Login handling
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('passwordInput').value;
            
            if (password === 'admin123') {
                sessionStorage.setItem('cmsAuth', 'authenticated');
                showCMS();
            } else {
                alert('Mot de passe incorrect');
            }
        });

        function logout() {
            sessionStorage.removeItem('cmsAuth');
            isAuthenticated = false;
            showLogin();
        }

        // Tab switching
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab appearance
            document.getElementById('newsTab').className = tab === 'news' 
                ? 'py-3 border-b-2 border-blue-500 text-blue-600 font-medium'
                : 'py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700';
            
            document.getElementById('jobsTab').className = tab === 'jobs'
                ? 'py-3 border-b-2 border-blue-500 text-blue-600 font-medium'
                : 'py-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700';
            
            // Show/hide job fields in modal
            const jobFields = document.getElementById('jobFields');
            if (tab === 'jobs') {
                jobFields.classList.remove('hidden');
            } else {
                jobFields.classList.add('hidden');
            }
            
            loadContent();
        }

        // Load content for current tab
        function loadContent() {
            if (!isAuthenticated) return;
            
            const content = getContentByType(currentTab === 'news' ? 'news' : 'job');
            const contentList = document.getElementById('contentList');
            
            if (content.length === 0) {
                contentList.innerHTML = `<p class="text-gray-500 text-center py-8">Aucun contenu ${currentTab === 'news' ? 'actualités' : 'emplois'} disponible.</p>`;
                return;
            }
            
            contentList.innerHTML = content.map(item => `
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <h3 class="font-bold text-lg mb-1">${item.title}</h3>
                            <p class="text-gray-600 text-sm mb-2">${item.subtitle}</p>
                            <div class="flex flex-wrap gap-2 text-xs">
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded">${item.category}</span>
                                <span class="px-2 py-1 bg-gray-100 text-gray-800 rounded">${formatDate(item.date)}</span>
                                ${item.salary ? `<span class="px-2 py-1 bg-green-100 text-green-800 rounded">${item.salary}</span>` : ''}
                            </div>
                        </div>
                        <div class="flex gap-2 ml-4">
                            <button onclick="editContent(${item.id})" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                                Modifier
                            </button>
                            <button onclick="deleteContent(${item.id})" class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                                Supprimer
                            </button>
                        </div>
                    </div>
                    <div class="content-preview text-gray-700 text-sm">
                        ${item.content.replace(/<[^>]*>/g, '').substring(0, 400)}...
                    </div>
                </div>
            `).join('');
        }

        // Modal functions
        function showAddModal() {
            document.getElementById('modalTitle').textContent = currentTab === 'news' ? 'Nouvelle Actualité' : 'Nouvel Emploi';
            document.getElementById('contentForm').reset();
            document.getElementById('contentId').value = '';
            document.getElementById('contentDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('contentModal').classList.add('active');
        }

        function editContent(id) {
            const content = getContentData().find(item => item.id === id);
            if (!content) return;
            
            document.getElementById('modalTitle').textContent = currentTab === 'news' ? 'Modifier Actualité' : 'Modifier Emploi';
            document.getElementById('contentId').value = content.id;
            document.getElementById('contentTitle').value = content.title;
            document.getElementById('contentSubtitle').value = content.subtitle;
            document.getElementById('contentCategory').value = content.category;
            document.getElementById('contentDate').value = content.date;
            document.getElementById('contentBody').value = content.content;
            if (content.salary) document.getElementById('contentSalary').value = content.salary;
            
            document.getElementById('contentModal').classList.add('active');
        }

        function closeContentModal() {
            document.getElementById('contentModal').classList.remove('active');
        }

        // Form submission
        document.getElementById('contentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('contentId').value;
            const contentData = {
                title: document.getElementById('contentTitle').value,
                subtitle: document.getElementById('contentSubtitle').value,
                category: document.getElementById('contentCategory').value,
                date: document.getElementById('contentDate').value,
                content: document.getElementById('contentBody').value,
                type: currentTab === 'news' ? 'news' : 'job'
            };
            
            if (currentTab === 'job') {
                contentData.salary = document.getElementById('contentSalary').value || 'À discuter';
                contentData.location = 'Montréal, QC';
                contentData.jobType = 'Temps plein';
            }
            
            if (id) {
                // Update existing content
                updateContent(parseInt(id), contentData);
            } else {
                // Add new content
                addContent(contentData);
            }
            
            closeContentModal();
            loadContent();
        });

        // Delete function
        window.deleteContent = function(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce contenu ?')) {
                deleteContent(id);
                loadContent();
            }
        };
    </script>

</body>
</html>